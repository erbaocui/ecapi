<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cn.dao.CustomerDeviceMapper" >
  <resultMap id="BaseResultMap" type="com.cn.model.CustomerDevice" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->

      <id column="Id" property="id" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="status" property="status" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="use_count" property="useCount" jdbcType="INTEGER" javaType="java.lang.Integer" />
    <result column="charge_count" property="chargeCount" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <result column="create_time" property="createTime" jdbcType="TIMESTAMP" javaType="java.util.Date" />

    <association property="device" javaType="com.cn.model.Device">
      <id column="device_id"  property="id" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="device_name"  property="name" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="device_lat"  property="lat"  jdbcType="DECIMAL" javaType="java.math.BigDecimal" />
      <result column="device_lon"  property="lon"  jdbcType="DECIMAL" javaType="java.math.BigDecimal" />
    </association>
    <association property="customer" javaType="com.cn.model.Customer">
      <id column="customer_id"  property="id" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="customer_login_name"  property="loginName" jdbcType="VARCHAR" javaType="java.lang.String" />
      <result column="customer_display_name"  property="displayName" jdbcType="VARCHAR" javaType="java.lang.String" />
    </association>
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, customer_id, device_id, status,count, create_date
  </sql>

  <select id="selectPageByEntity" parameterType="com.cn.model.CustomerDevice" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    cd.id,cd.status,cd.use_count,cd.charge_count, cd.create_time,cd.customer_id,cd.device_id,
    c.display_name  as customer_display_name,c.login_name as customer_login_name,
    d.name as device_name,d.lat as device_lat,d.lon as device_lon
    from t_customer_device cd
    INNER  JOIN  t_customer c on c.id=cd.customer_id
    INNER JOIN  t_device d on d.id=cd.device_id
    where 1=1
    <if test="customer!= null" >
      <if test="customer.id!= null">
        and cd.customer_id= '${customer.id}'
      </if>
    </if>
    <if test="device!= null" >
      <if test="device.id!= null">
        and cd.device_id= '${device.id}'
      </if>
    </if>
    <if test="status!= null">
      and cd.status= '${status}'
    </if>
    order by cd.create_time DESC
  </select>

  <select id="selectOneByEntity" parameterType="com.cn.model.CustomerDevice" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    cd.id,cd.status,cd.use_count,cd.charge_count,cd.create_time,cd.customer_id,cd.device_id,
    c.display_name  as customer_display_name,c.login_name as customer_login_name,
    d.name as device_name,d.lat as device_lat,d.lon as device_lon
    from t_customer_device cd
    INNER  JOIN  t_customer c on c.id=cd.customer_id
    INNER JOIN  t_device d on d.id=cd.device_id
    where 1=1
    <if test="customer!= null" >
      <if test="customer.id!= null">
        and cd.customer_id= '${customer.id}'
      </if>
    </if>
    <if test="device!= null" >
      <if test="device.id!= null">
        and cd.device_id= '${device.id}'
      </if>
    </if>
    <if test="status!= null">
      and cd.status= '${status}'
    </if>
    limit 1

  </select>
  <insert id="insert" parameterType="com.cn.model.CustomerDevice" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into t_customer_device
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="customer.id != null" >
        customer_id,
      </if>
      <if test="device.id != null" >
        device_id,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="customer.id != null" >
        #{customer.id,jdbcType=VARCHAR},
      </if>
      <if test="device.id != null" >
        #{device.id,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="update" parameterType="com.cn.model.CustomerDevice" >
    update t_customer_device
    <set >

      <if test="status != null" >
        status = #{status,jdbcType=VARCHAR},
      </if>
      <if test="useCount != null" >
        user_count = #{useCount,jdbcType=INTEGER},
      </if>
      <if test="chargeCount != null" >
        charge_count = #{ chargeCount,jdbcType=INTEGER},
      </if>

    </set>
    where  1=1
    <if test="id != null">
    and id = #{id,jdbcType=VARCHAR}
    </if>
     <if test="customer!= null" >
       <if test="customer.id != null" >
        and customer_id=#{customer.id,jdbcType=VARCHAR}
       </if>
    </if>
    <if test="device!= null" >
      <if test="device.id != null" >
       and device_id=#{device.id,jdbcType=VARCHAR}
      </if>
    </if>
  </update>
</mapper>